{
  "dependencies": [
    {
      "sourceFile": "DBDRIVR1.cbl",
      "targetFile": "SQLCA.cpy",
      "dependencyType": "COPY",
      "lineNumber": 0,
      "context": "Copybook inclusion"
    },
    {
      "sourceFile": "DBDRIVR1.cbl",
      "targetFile": "DPOLICY.cpy",
      "dependencyType": "COPY",
      "lineNumber": 0,
      "context": "Copybook inclusion"
    },
    {
      "sourceFile": "DBDRIVR1.cbl",
      "targetFile": "DCOVERAG.cpy",
      "dependencyType": "COPY",
      "lineNumber": 0,
      "context": "Copybook inclusion"
    },
    {
      "sourceFile": "DBDRIVR1.cbl",
      "targetFile": "DTRAKING.cpy",
      "dependencyType": "COPY",
      "lineNumber": 0,
      "context": "Copybook inclusion"
    },
    {
      "sourceFile": "DBDRIVR2.cbl",
      "targetFile": "SQLCA.cpy",
      "dependencyType": "COPY",
      "lineNumber": 0,
      "context": "Copybook inclusion"
    },
    {
      "sourceFile": "DBDRIVR2.cbl",
      "targetFile": "DTRAKING.cpy",
      "dependencyType": "COPY",
      "lineNumber": 0,
      "context": "Copybook inclusion"
    },
    {
      "sourceFile": "FLDRIVR1.cbl",
      "targetFile": "CAGENT.cpy",
      "dependencyType": "COPY",
      "lineNumber": 0,
      "context": "Copybook inclusion"
    },
    {
      "sourceFile": "MAINPGM.cbl",
      "targetFile": "CPOLICY.cpy",
      "dependencyType": "COPY",
      "lineNumber": 0,
      "context": "Copybook inclusion"
    },
    {
      "sourceFile": "MAINPGM.cbl",
      "targetFile": "CAGENT.cpy",
      "dependencyType": "COPY",
      "lineNumber": 0,
      "context": "Copybook inclusion"
    },
    {
      "sourceFile": "MAINPGM.cbl",
      "targetFile": "CUSTNTFY.cpy",
      "dependencyType": "COPY",
      "lineNumber": 0,
      "context": "Copybook inclusion"
    },
    {
      "sourceFile": "MAINPGM.cbl",
      "targetFile": "AGNTNTFY.cpy",
      "dependencyType": "COPY",
      "lineNumber": 0,
      "context": "Copybook inclusion"
    }
  ],
  "copybookUsage": {
    "DBDRIVR1.cbl": [
      "SQLCA.cpy",
      "DPOLICY.cpy",
      "DCOVERAG.cpy",
      "DTRAKING.cpy"
    ],
    "DBDRIVR2.cbl": [
      "SQLCA.cpy",
      "DTRAKING.cpy"
    ],
    "FLDRIVR1.cbl": [
      "CAGENT.cpy"
    ],
    "FLDRIVR2.cbl": [],
    "MAINPGM.cbl": [
      "CPOLICY.cpy",
      "CAGENT.cpy",
      "CUSTNTFY.cpy",
      "AGNTNTFY.cpy"
    ]
  },
  "reverseDependencies": {
    "SQLCA.cpy": [
      "DBDRIVR1.cbl",
      "DBDRIVR2.cbl"
    ],
    "DPOLICY.cpy": [
      "DBDRIVR1.cbl"
    ],
    "DCOVERAG.cpy": [
      "DBDRIVR1.cbl"
    ],
    "DTRAKING.cpy": [
      "DBDRIVR1.cbl",
      "DBDRIVR2.cbl"
    ],
    "CAGENT.cpy": [
      "FLDRIVR1.cbl",
      "MAINPGM.cbl"
    ],
    "CPOLICY.cpy": [
      "MAINPGM.cbl"
    ],
    "CUSTNTFY.cpy": [
      "MAINPGM.cbl"
    ],
    "AGNTNTFY.cpy": [
      "MAINPGM.cbl"
    ]
  },
  "mermaidDiagram": "graph TB\n  %% Styles\n  classDef program fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#0d47a1;\n  classDef copybook fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#e65100;\n  classDef mainProgram fill:#c8e6c9,stroke:#388e3c,stroke-width:3px,color:#1b5e20;\n\n  %% Programs Subgraph\n  subgraph Programs\n    direction TB\n    DBDRIVR1[\u0022DBDRIVR1.cbl\u0022]\n    DBDRIVR2[\u0022DBDRIVR2.cbl\u0022]\n    FLDRIVR1[\u0022FLDRIVR1.cbl\u0022]\n    FLDRIVR2[\u0022FLDRIVR2.cbl\u0022]\n    MAINPGM[\u0022MAINPGM.cbl\u0022]\n  end\n\n  %% Copybooks Subgraph\n  subgraph Copybooks\n    direction TB\n    SQLCA[\u0022SQLCA.cpy\u0022]\n    DPOLICY[\u0022DPOLICY.cpy\u0022]\n    DCOVERAG[\u0022DCOVERAG.cpy\u0022]\n    DTRAKING[\u0022DTRAKING.cpy\u0022]\n    CAGENT[\u0022CAGENT.cpy\u0022]\n    CPOLICY[\u0022CPOLICY.cpy\u0022]\n    CUSTNTFY[\u0022CUSTNTFY.cpy\u0022]\n    AGNTNTFY[\u0022AGNTNTFY.cpy\u0022]\n  end\n\n  %% Dependencies\n  DBDRIVR1 --\u003E|COPY| SQLCA\n  DBDRIVR1 --\u003E|COPY| DPOLICY\n  DBDRIVR1 --\u003E|COPY| DCOVERAG\n  DBDRIVR1 --\u003E|COPY| DTRAKING\n\n  DBDRIVR2 --\u003E|COPY| SQLCA\n  DBDRIVR2 --\u003E|COPY| DTRAKING\n\n  FLDRIVR1 --\u003E|COPY| CAGENT\n\n  MAINPGM --\u003E|COPY| CPOLICY\n  MAINPGM --\u003E|COPY| CAGENT\n  MAINPGM --\u003E|COPY| CUSTNTFY\n  MAINPGM --\u003E|COPY| AGNTNTFY\n\n  %% Assign styles\n  class DBDRIVR1,DBDRIVR2,FLDRIVR1,FLDRIVR2 program;\n  class MAINPGM mainProgram;\n  class SQLCA,DPOLICY,DCOVERAG,DTRAKING,CAGENT,CPOLICY,CUSTNTFY,AGNTNTFY copybook;",
  "analysisInsights": "**COBOL Dependency Structure Analysis**\n\n---\n\n### 1. **Data Flow Dependencies Between Copybooks**\n\n#### **Copybook Usage Matrix**\n\n| Program       | Copybooks Used                                 |\n|---------------|------------------------------------------------|\n| DBDRIVR1.cbl  | SQLCA.cpy, DPOLICY.cpy, DCOVERAG.cpy, DTRAKING.cpy |\n| DBDRIVR2.cbl  | SQLCA.cpy, DTRAKING.cpy                        |\n| FLDRIVR1.cbl  | CAGENT.cpy                                     |\n| FLDRIVR2.cbl  | (none)                                         |\n| MAINPGM.cbl   | CPOLICY.cpy, CAGENT.cpy, CUSTNTFY.cpy, AGNTNTFY.cpy |\n\n#### **Observations:**\n- **DBDRIVR1.cbl** and **DBDRIVR2.cbl** share **SQLCA.cpy** and **DTRAKING.cpy** (likely for DB status and tracking).\n- **MAINPGM.cbl** uses four copybooks, two of which (**CPOLICY.cpy** and **CAGENT.cpy**) suggest overlap with the domain of the DB drivers.\n- **FLDRIVR1.cbl** and **MAINPGM.cbl** both use **CAGENT.cpy** (agent data).\n- **FLDRIVR2.cbl** uses no copybooks.\n\n#### **Data Flow:**\n- **SQLCA.cpy** is a standard SQL communication area, indicating DB interaction.\n- **DTRAKING.cpy** is used in both DB drivers, suggesting shared tracking logic.\n- **CAGENT.cpy** is shared between FLDRIVR1 and MAINPGM, implying agent data is processed in multiple places.\n- **DPOLICY.cpy**, **DCOVERAG.cpy**, **CPOLICY.cpy**: Policy data is split between DB and main program, possibly with different structures.\n\n---\n\n### 2. **Potential Circular Dependencies**\n\n- **No direct circular dependencies** are apparent from the copybook usage alone.\n- **Indirect risk**: If copybooks themselves include other copybooks (not shown here), circularity could arise.\n- **MAINPGM.cbl** is the most complex, using multiple copybooks, but none of the programs use each other as copybooks.\n- **Recommendation**: Review copybook contents for nested COPY statements to confirm absence of circularity.\n\n---\n\n### 3. **Modularity Recommendations**\n\n- **Reduce Copybook Overlap**: If **DPOLICY.cpy** and **CPOLICY.cpy** are similar, consider unifying them to avoid data duplication and maintenance overhead.\n- **Centralize Common Structures**: **CAGENT.cpy** is used in multiple programs; ensure it contains only agent-related data and logic.\n- **Isolate SQLCA.cpy Usage**: Restrict SQLCA.cpy to DB interaction modules (DBDRIVR1/2) to avoid unnecessary DB dependencies elsewhere.\n- **Encapsulate Notification Logic**: **CUSTNTFY.cpy** and **AGNTNTFY.cpy** in MAINPGM suggest notification logic; consider moving notification routines to a dedicated module or copybook for reuse.\n- **FLDRIVR2.cbl** has no copybooks; if it shares logic/data with others, consider refactoring for consistency.\n\n---\n\n### 4. **Legacy Patterns Affecting Dependencies**\n\n- **Heavy Use of Copybooks**: Indicates legacy practice of sharing data structures, which can lead to tight coupling.\n- **SQLCA.cpy Usage**: Standard in legacy COBOL for DB status, but can propagate DB dependencies unnecessarily.\n- **Multiple Policy Copybooks**: Suggests historical fragmentation of data definitions.\n- **Large MAINPGM.cbl** (28K chars): Monolithic main program is a legacy anti-pattern; consider breaking into smaller, focused modules.\n- **Flat Copybook Inclusion**: No evidence of hierarchical or object-oriented structuring, typical of older COBOL codebases.\n\n---\n\n## **Summary \u0026 Recommendations**\n\n**Dependency Structure Insights:**\n- Data dependencies are mostly linear, with some overlap in agent and policy data.\n- No circular dependencies detected, but nested copybook inclusion should be checked.\n- Legacy patterns (large main program, fragmented copybooks) increase maintenance risk.\n\n**Recommendations:**\n1. **Audit and Consolidate Copybooks**: Merge similar copybooks (e.g., policy-related) to reduce redundancy.\n2. **Modularize Large Programs**: Break MAINPGM.cbl into smaller, purpose-driven modules.\n3. **Limit Copybook Scope**: Use copybooks only where necessary; avoid global inclusion.\n4. **Refactor for Reuse**: Move common notification logic to shared modules.\n5. **Review for Hidden Circularity**: Inspect copybooks for nested COPY statements.\n\n**Overall:**  \nThe project shows typical legacy COBOL dependency patterns. Improving modularity and reducing copybook overlap will enhance maintainability and reduce risk of hidden dependencies.",
  "metrics": {
    "totalPrograms": 5,
    "totalCopybooks": 7,
    "totalDependencies": 11,
    "averageDependenciesPerProgram": 2.2,
    "mostUsedCopybook": "SQLCA.cpy",
    "mostUsedCopybookCount": 2,
    "circularDependencies": []
  },
  "createdAt": "2025-11-11T06:08:33.718303Z"
}